name: 'Test'

on:
  push:
    branches: [ toolversions ]
  workflow_dispatch:
  
jobs:

  # Update Docker Hub description
  toolversions:

    name: 'Get Image Tool Versions'
    runs-on: ubuntu-latest

    strategy:

      matrix:
        include:
          - tag: ${{ endsWith(github.ref, 'refs/heads/main') && 'debian' || 'debian-develop' }}
          - tag: ${{ endsWith(github.ref, 'refs/heads/main') && 'alpine' || 'alpine-develop' }}
          - tag: ${{ endsWith(github.ref, 'refs/heads/main') && 'savoury' || 'savoury-develop' }}
          - tag: ${{ endsWith(github.ref, 'refs/heads/main') && 'arch' || 'arch-develop' }}

    steps:

    - name: Checkout 
      uses: actions/checkout@v2
  
    - name: Get Versions
      uses: addnab/docker-run-action@v3
      with:
        image: docker.io/ptr727/plexcleaner:${{ matrix.tag }}
        options: --volume ${{ github.workspace }}:/workspace
        run: |
          echo /PlexCleaner/PlexCleaner --version > /workspace/${{ matrix.tag }}
          echo dotnet --version >> /workspace/${{ matrix.tag }}
          echo HandBrakeCLI --version >> /workspace/${{ matrix.tag }}
          echo mediainfo --version >> /workspace/${{ matrix.tag }}
          echo mkvmerge --version >> /workspace/${{ matrix.tag }}
          echo ffmpeg -version >> /workspace/${{ matrix.tag }}

    - name: Print Versions
      run: cat ${{ github.workspace }}/${{ matrix.tag }}
